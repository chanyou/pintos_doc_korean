<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->  
<head>
    <title>Pintos Document in Korean - Project 1: Threads </title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pintos 한글 문서">
    <meta name="author" content="">    
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">
    
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
</head> 

<body class="body-green">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span aria-hidden="true" class="icon_documents_alt icon"></span>
                            <span class="text-bold">Pintos Document</span><span class="text-highlight"> Korean ver.</span>
                        </a>
                    </h1>
                </div><!--//branding-->
                <ol class="breadcrumb">
                    <li><a href="index.html">Home</a></li>
                    <li class="active">Project 1: Threads</li>
                </ol>
            </div><!--//container-->
        </header><!--//header-->
        <div class="doc-wrapper">
            <div class="container">
                <div id="doc-header" class="doc-header text-center">
                    <h1 class="doc-title"><i class="icon fa fa-play-circle"></i> Project 1: Threads</h1>
                    <!--<div class="meta"><i class="fa fa-clock-o"></i> Last updated: Jan 25th, 2016</div> -->
                </div><!--//doc-header-->
                <div class="doc-body">
                    <div class="doc-content">
                        <div class="content-inner">

                            <section id="intro-section" class="doc-section">
                                <h2 class="section-title">Introduction</h2>
                                <div class="section-block">
                                 <P>
                                    이 프로젝트는 구현되어있는 최소한의 thread system을 확장하는 것을 목표로 합니다. 여러분은 작성되어 있는 코드를 수정하며 OS에서 발생하는 synchronization 문제들에 대한 이해를 넓혀가게 될 것입니다.
                                </P>
                                <P>
                                    여러분은 주로 <Q><TT>threads</TT></Q> 디렉토리에서 작업을 진행하게 될 것이며, <Q><TT>devices</TT></Q>의 코드를 조금 수정할 필요가 있을 것입니다.
                                    모든 build와 test는 <Q><TT>threads</TT></Q>에서 진행되어야 합니다.
                                </P>
                                <P>
                                    Before you read the description of this project, you should read all of
                                    the following sections: <A HREF="pintos_1.html#SEC1">1. Introduction</A>, <A HREF="pintos_8.html#SEC138">C. Coding Standards</A>,
                                    <A HREF="pintos_10.html#SEC145">E. Debugging Tools</A>, and <A HREF="pintos_11.html#SEC158">F. Development Tools</A>.  You should at least
                                    skim the material from <A HREF="pintos_6.html#SEC91">A.1 Loading</A> through <A HREF="pintos_6.html#SEC111">A.5 Memory Allocation</A>, especially <A HREF="pintos_6.html#SEC100">A.3 Synchronization</A>.  To complete this project
                                    you will also need to read <A HREF="pintos_7.html#SEC131">B. 4.4<ACRONYM>BSD</ACRONYM> Scheduler</A>.
                                </P>
                                </div>
                            </section><!--//doc-section-->

                            <section id="background-section" class="doc-section">
                                <h2 class="section-title">Background</h2>
                                <div class="section-block">
                                   <P>
                                </P>
                                </div>
                                <div id="understanding"  class="section-block">
                                    <h3 class="block-title">Understanding Threads</h3>
                                    <P>
                                        The first step is to read and understand the code for the initial thread
                                        system.
                                        Pintos already implements thread creation and thread completion,
                                        a simple scheduler to switch between threads, and synchronization
                                        primitives (semaphores, locks, condition variables, and optimization
                                        barriers).
                                    </P>
                                    <P>
                                        Some of this code might seem slightly mysterious.  If
                                        you haven't already compiled and run the base system, as described in
                                        the introduction (see section <A HREF="pintos_1.html#SEC1">1. Introduction</A>), you should do so now.  You
                                        can read through parts of the source code to see what's going
                                        on.  If you like, you can add calls to <CODE>printf()</CODE> almost
                                        anywhere, then recompile and run to see what happens and in what
                                        order.  You can also run the kernel in a debugger and set breakpoints
                                        at interesting spots, single-step through code and examine data, and
                                        so on.
                                    </P>
                                    <P>

                                        When a thread is created, you are creating a new context to be
                                        scheduled.  You provide a function to be run in this context as an
                                        argument to <CODE>thread_create()</CODE>.  The first time the thread is
                                        scheduled and runs, it starts from the beginning of that function
                                        and executes in that context.  When the function returns, the thread
                                        terminates.  Each thread, therefore, acts like a mini-program running
                                        inside Pintos, with the function passed to <CODE>thread_create()</CODE>
                                        acting like <CODE>main()</CODE>.
                                    </P>
                                    <P>

                                        At any given time, exactly one thread runs and the rest, if any,
                                        become inactive.  The scheduler decides which thread to
                                        run next.  (If no thread is ready to run
                                        at any given time, then the special &quot;idle&quot; thread, implemented in
                                        <CODE>idle()</CODE>, runs.)
                                        Synchronization primitives can force context switches when one
                                        thread needs to wait for another thread to do something.
                                    </P>
                                    <P>

                                        The mechanics of a context switch are
                                        in <Q><TT>threads/switch.S</TT></Q>, which is 80<VAR>x</VAR>86
                                        assembly code.  (You don't have to understand it.)  It saves the
                                        state of the currently running thread and restores the state of the
                                        thread we're switching to.
                                    </P>
                                    <P>

                                        Using the GDB debugger, slowly trace through a context
                                        switch to see what happens (see section <A HREF="pintos_10.html#SEC151">E.5 GDB</A>).  You can set a
                                        breakpoint on <CODE>schedule()</CODE> to start out, and then
                                        single-step from there.<A NAME="DOCF2" HREF="pintos_fot.html#FOOT2">(2)</A>  Be sure
                                        to keep track of each thread's address
                                        and state, and what procedures are on the call stack for each thread.
                                        You will notice that when one thread calls <CODE>switch_threads()</CODE>,
                                        another thread starts running, and the first thing the new thread does
                                        is to return from <CODE>switch_threads()</CODE>.  You will understand the thread
                                        system once you understand why and how the <CODE>switch_threads()</CODE> that
                                        gets called is different from the <CODE>switch_threads()</CODE> that returns.
                                        See section <A HREF="pintos_6.html#SEC99">A.2.3 Thread Switching</A>, for more information.
                                    </P>
                                    <P>

                                        <STRONG>Warning</STRONG>: In Pintos, each thread is assigned a small,
                                        fixed-size execution stack just under 4 kB in size.  The kernel
                                        tries to detect stack overflow, but it cannot do so perfectly.  You
                                        may cause bizarre problems, such as mysterious kernel panics, if you
                                        declare large data structures as non-static local variables,
                                        e.g. <Q><SAMP>int buf[1000];</SAMP></Q>.  Alternatives to stack allocation include
                                        the page allocator and the block allocator (see section <A HREF="pintos_6.html#SEC111">A.5 Memory Allocation</A>).
                                    </P>
                                </div>
                                <div id="source"  class="section-block">
                                    <h3 class="block-title">Source Files</h3>
                                    <P>
                                        Here is a brief overview of the files in the <Q><TT>threads</TT></Q>
                                        directory.  You will not need to modify most of this code, but the
                                        hope is that presenting this overview will give you a start on what
                                        code to look at.
                                    </P>

                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>File Name</th>
                                                    <th>Description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">loader.S, loader.h</th>
                                                    <td>The kernel loader.  Assembles to 512 bytes of code and data that the
                                                        PC BIOS loads into memory and which in turn finds the kernel on disk,
                                                        loads it into memory, and jumps to <CODE>start()</CODE> in <Q><TT>start.S</TT></Q>.
                                                        See section <A HREF="pintos_6.html#SEC92">A.1.1 The Loader</A>, for details.  You should not need to look at
                                                    this code or modify it.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">start.S</th>
                                                    <td>>Does basic setup needed for memory protection and 32-bit
                                                        operation on 80<VAR>x</VAR>86 CPUs.  Unlike the loader, this code is
                                                        actually part of the kernel.  See section <A HREF="pintos_6.html#SEC93">A.1.2 Low-Level Kernel Initialization</A>,
                                                    for details.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kernel.lds.S</th>
                                                    <td>The linker script used to link the kernel.  Sets the load address of
                                                        the kernel and arranges for <Q><TT>start.S</TT></Q> to be near the beginning
                                                        of the kernel image.  See section <A HREF="pintos_6.html#SEC92">A.1.1 The Loader</A>, for details. Again, you
                                                        should not need to look at this code
                                                    or modify it, but it's here in case you're curious.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">init.c, init.h</th>
                                                    <td>Kernel initialization, including <CODE>main()</CODE>, the kernel's &quot;main
                                                        program.&quot;  You should look over <CODE>main()</CODE> at least to see what
                                                        gets initialized.  You might want to add your own initialization code
                                                        here.  See section <A HREF="pintos_6.html#SEC94">A.1.3 High-Level Kernel Initialization</A>, for details.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">thread.c, thread.h</th>
                                                    <td>Basic thread support.  Much of your work will take place in these files.
                                                        <Q><TT>thread.h</TT></Q> defines <CODE>struct thread</CODE>, which you are likely to modify
                                                        in all four projects.  See <A HREF="pintos_6.html#SEC97">A.2.1 <CODE>struct thread</CODE></A> and <A HREF="pintos_6.html#SEC96">A.2 Threads</A> for
                                                    more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">switch.S, switch.h</th>
                                                    <td>Assembly language routine for switching threads.  Already discussed
                                                        above.  See section <A HREF="pintos_6.html#SEC98">A.2.2 Thread Functions</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">palloc.c, palloc.h</th>
                                                    <td>Page allocator, which hands out system memory in multiples of 4 kB
                                                        pages.  See section <A HREF="pintos_6.html#SEC112">A.5.1 Page Allocator</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">malloc.c, malloc.h</th>
                                                    <td>A simple implementation of <CODE>malloc()</CODE> and <CODE>free()</CODE> for
                                                            the kernel.  See section <A HREF="pintos_6.html#SEC113">A.5.2 Block Allocator</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">interrupt.c, interrupt.h</th>
                                                    <td>Basic interrupt handling and functions for turning interrupts on and
                                                        off.  See section <A HREF="pintos_6.html#SEC107">A.4 Interrupt Handling</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">intr-stubs.S, intr-stubs.h</th>
                                                    <td>Assembly code for low-level interrupt handling.  See section <A HREF="pintos_6.html#SEC108">A.4.1 Interrupt Infrastructure</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">synch.c, synch.h</th>
                                                    <td>Basic synchronization primitives: semaphores, locks, condition
                                                        variables, and optimization barriers.  You will need to use these for
                                                        synchronization in all
                                                        four projects.  See section <A HREF="pintos_6.html#SEC100">A.3 Synchronization</A>, for more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">io.h</th>
                                                    <td>Functions for I/O port access.  This is mostly used by source code in
                                                        the <Q><TT>devices</TT></Q> directory that you won't have to touch.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">vaddr.h, pte.h</th>
                                                    <td>Functions and macros for working with virtual addresses and page table
                                                        entries.  These will be more important to you in project 3.  For now,
                                                    you can ignore them.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">flags.h</th>
                                                    <td>Macros that define a few bits in the 80<VAR>x</VAR>86 &quot;flags&quot; register.
                                                        Probably of no interest.  See [ <A HREF="pintos_13.html#IA32-v1">IA32-v1</A>], section 3.4.3, &quot;EFLAGS
                                                    Register,&quot; for more information.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->
                                    <h4>Devices code</h4>
                                    <P>
                                        The basic threaded kernel also includes these files in the
                                        <Q><TT>devices</TT></Q> directory:
                                    </P>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>File Name</th>
                                                    <th>Description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">timer.c, timer.h</th>
                                                    <td>System timer that ticks, by default, 100 times per second.  You will
                                                    modify this code in this project.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">vga.c, vga.h</th>
                                                    <td>>VGA display driver.  Responsible for writing text to the screen.
                                                        You should have no need to look at this code.  <CODE>printf()</CODE>
                                                        calls into the VGA display driver for you, so there's little reason to
                                                    call this code yourself.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">serial.c, serial.h</th>
                                                    <td>An abstraction layer for <EM>block devices</EM>, that is, random-access,
                                                        disk-like devices that are organized as arrays of fixed-size blocks.
                                                        Out of the box, Pintos supports two types of block devices: IDE disks
                                                        and partitions.  Block devices, regardless of type, won't actually be
                                                    used until project 2.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">ide.c, ide.h</th>
                                                    <td>Supports reading and writing sectors on up to 4 IDE disks.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">partition.c, partition.h</th>
                                                    <td>Understands the structure of partitions on disks, allowing a single
                                                        disk to be carved up into multiple regions (partitions) for
                                                    independent use.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kbd.c, kbd.h</th>
                                                    <td>Keyboard driver.  Handles keystrokes passing them to the input layer
                                                    (see below).</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">input.c, input.h</th>
                                                    <td>Input layer.  Queues input characters passed along by the keyboard or
                                                serial drivers.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">intq.c, intq.h</th>
                                                    <td>Interrupt queue, for managing a circular queue that both kernel
                                                        threads and interrupt handlers want to access.  Used by the keyboard
                                                    and serial drivers.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">rtc.c, rtc.h</th>
                                                    <td>Real-time clock driver, to enable the kernel to determine the current
                                                        date and time.  By default, this is only used by <Q><TT>thread/init.c</TT></Q>
                                                    to choose an initial seed for the random number generator.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">speaker.c speaker.h</th>
                                                    <td>>Driver that can produce tones on the PC speaker.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">pit.c, pit.h</th>
                                                    <td>Code to configure the 8254 Programmable Interrupt Timer.  This code is
                                                        used by both <Q><TT>devices/timer.c</TT></Q> and <Q><TT>devices/speaker.c</TT></Q>
                                                    because each device uses one of the PIT's output channel.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->
                                    <h4> Lib files </h4>
                                    <P>

                                        Finally, <Q><TT>lib</TT></Q> and <Q><TT>lib/kernel</TT></Q> contain useful library
                                        routines.  (<Q><TT>lib/user</TT></Q> will be used by user programs, starting in
                                        project 2, but it is not part of the kernel.)  Here's a few more
                                        details:
                                    </P>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>File Name</th>
                                                    <th>Description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">ctype.h, 
                                                        inttypes.h, 
                                                        limits.h, 
                                                        stdarg.h, 
                                                        stdbool.h, 
                                                        stddef.h, 
                                                        stdint.h, 
                                                        stdio.c, 
                                                        stdio.h, 
                                                        stdlib.c, 
                                                        stdlib.h, 
                                                        string.c, 
                                                    string.h</th>
                                                    <td>A subset of the standard C library.  See section <A HREF="pintos_8.html#SEC140">C.2 C99</A>, for
                                                        information
                                                        on a few recently introduced pieces of the C library that you might
                                                        not have encountered before.  See section <A HREF="pintos_8.html#SEC141">C.3 Unsafe String Functions</A>, for
                                                    information on what's been intentionally left out for safety.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">debug.c, debug.h</th>
                                                    <td>Functions and macros to aid debugging.  See section <A HREF="pintos_10.html#SEC145">E. Debugging Tools</A>, for
                                                    more information.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">random.c, random.h</th>
                                                    <td>Pseudo-random number generator.  The actual sequence of random values
                                                        will not vary from one Pintos run to another, unless you do one of
                                                        three things: specify a new random seed value on the <Q><SAMP>-rs</SAMP></Q>
                                                        kernel command-line option on each run, or use a simulator other than
                                                        Bochs, or specify the <Q><SAMP>-r</SAMP></Q> option to <CODE>pintos</CODE>.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">round.h</th>
                                                    <td>Macros for rounding.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">syscall-nr.h</th>
                                                    <td>System call numbers.  Not used until project 2.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kernel/list.c, kernel/list.h</th>
                                                    <td>Doubly linked list implementation.  Used all over the Pintos code, and
                                                    you'll probably want to use it a few places yourself in project 1.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kernel/bitmap.c, kernel/bitmap.h</th>
                                                    <td>Bitmap implementation.  You can use this in your code if you like, but
                                                    you probably won't have any need for it in project 1.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kernel/hash.c, kernel/hash.h</th>
                                                    <td>Hash table implementation.  Likely to come in handy for project 3.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">kernel/console.c, 
                                                        kernel/console.h, 
                                                    kernel/stdio.h</th>
                                                    <td>Implements <CODE>printf()</CODE> and a few other functions.</td>
                                                </tr>
                                               
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->

                                </div><!--//section-block-->

                                <div id="sync"  class="section-block">
                                    <h3 class="block-title">Synchronization</h3>
                                    <P>

                                        Proper synchronization is an important part of the solutions to these
                                        problems.  Any synchronization problem can be easily solved by turning
                                        interrupts off: while interrupts are off, there is no concurrency, so
                                        there's no possibility for race conditions.  Therefore, it's tempting to
                                        solve all synchronization problems this way, but <STRONG>don't</STRONG>.
                                        Instead, use semaphores, locks, and condition variables to solve the
                                        bulk of your synchronization problems.  Read the tour section on
                                        synchronization (see section <A HREF="pintos_6.html#SEC100">A.3 Synchronization</A>) or the comments in
                                        <Q><TT>threads/synch.c</TT></Q> if you're unsure what synchronization primitives
                                        may be used in what situations.
                                    </P>
                                    <P>

                                        In the Pintos projects, the only class of problem best solved by
                                        disabling interrupts is coordinating data shared between a kernel thread
                                        and an interrupt handler.  Because interrupt handlers can't sleep, they
                                        can't acquire locks.  This means that data shared between kernel threads
                                        and an interrupt handler must be protected within a kernel thread by
                                        turning off interrupts.
                                    </P>
                                    <P>

                                        This project only requires accessing a little bit of thread state from
                                        interrupt handlers.  For the alarm clock, the timer interrupt needs to
                                        wake up sleeping threads.  In the advanced scheduler, the timer
                                        interrupt needs to access a few global and per-thread variables.  When
                                        you access these variables from kernel threads, you will need to disable
                                        interrupts to prevent the timer interrupt from interfering.
                                    </P>
                                    <P>

                                        When you do turn off interrupts, take care to do so for the least amount
                                        of code possible, or you can end up losing important things such as
                                        timer ticks or input events.  Turning off interrupts also increases the
                                        interrupt handling latency, which can make a machine feel sluggish if
                                        taken too far.
                                    </P>
                                    <P>

                                        The synchronization primitives themselves in <Q><TT>synch.c</TT></Q> are
                                        implemented by disabling interrupts.  You may need to increase the
                                        amount of code that runs with interrupts disabled here, but you should
                                        still try to keep it to a minimum.
                                    </P>
                                    <P>

                                        Disabling interrupts can be useful for debugging, if you want to make
                                        sure that a section of code is not interrupted.  You should remove
                                        debugging code before turning in your project.  (Don't just comment it
                                        out, because that can make the code difficult to read.)
                                    </P>
                                    <P>

                                        There should be no busy waiting in your submission.  A tight loop that
                                        calls <CODE>thread_yield()</CODE> is one form of busy waiting.
                                    </P>
                                    
                                </div><!--//section-block-->
                                <div id="devsuggestion"  class="section-block">
                                    <h3 class="block-title">Development Suggestions</h3>
                                    <P>

                                        In the past, many groups divided the assignment into pieces, then each
                                        group member worked on his or her piece until just before the
                                        deadline, at which time the group reconvened to combine their code and
                                        submit.  <STRONG>This is a bad idea.  We do not recommend this
                                        approach.</STRONG>  Groups that do this often find that two changes conflict
                                        with each other, requiring lots of last-minute debugging.  Some groups
                                        who have done this have turned in code that did not even compile or
                                        boot, much less pass any tests.
                                    </P>
                                    <P>

                                        Instead, we recommend integrating your team's changes early and often,
                                        using a source code control system such as <A HREF="http://subversion.tigris.org">Subversion</A>, or
                                        better yet <A HREF="http://git-scm.com">git</A>.
                                        This is less likely to produce surprises, because everyone can see
                                        everyone else's code as it is written, instead of just when it is
                                        finished.  These systems also make it possible to review changes and,
                                        when a change introduces a bug, drop back to working versions of code.
                                    </P>
                                    <P>

                                        You should expect to run into bugs that you simply don't understand
                                        while working on this and subsequent projects.  When you do,
                                        reread the appendix on debugging tools, which is filled with
                                        useful debugging tips that should help you to get back up to speed
                                        (see section <A HREF="pintos_10.html#SEC145">E. Debugging Tools</A>).  Be sure to read the section on backtraces
                                        (see section <A HREF="pintos_10.html#SEC149">E.4 Backtraces</A>), which will help you to get the most out of every
                                        kernel panic or assertion failure.
                                    </P>
                                </div><!--//section-block-->
                            </section><!--//doc-section-->

                            <section id="requirement-section" class="doc-section">
                                <h2 class="section-title">Requirements</h2>
								<p> We will grade your assignments based on test results and design quality, each of which comprises 50% of your grade. </p>
                                <div id="document"  class="section-block">
                                    <h3 class="block-title">Design Document</h3>
                                    <P>

                                        Before you turn in your project, you must copy <A HREF="threads.tmpl">the
                                        project 1 design document template</A> into your source tree under the name
                                        <Q><TT>pintos/src/threads/DESIGNDOC</TT></Q> and fill it in.  We recommend that
                                        you read the design document template before you start working on the
                                        project.  See section <A HREF="pintos_9.html#SEC142">D. Project Documentation</A>, for a sample design document
                                        that goes along with a fictitious project.
                                    </P>

                                </div><!--//section-block-->
                                <div id="alarm"  class="section-block">
                                    <h3 class="block-title">Alarm Clock</h3>
                                    <P>

                                        Reimplement <CODE>timer_sleep()</CODE>, defined in <Q><TT>devices/timer.c</TT></Q>.
                                        Although a working implementation is provided, it &quot;busy waits,&quot; that
                                        is, it spins in a loop checking the current time and calling
                                        <CODE>thread_yield()</CODE> until enough time has gone by.  Reimplement it to
                                        avoid busy waiting.
                                    </P>
                                    <P>

									<div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th><U>Function:</U> void <B>timer_sleep</B> (int64_t <VAR>ticks</VAR>)</th>
                                                    
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td scope="row">
                                                        <p>
                                                        Suspends execution of the calling thread until time has advanced by at
                                                        least <VAR>x</VAR> timer ticks.  Unless the system is otherwise idle, the
                                                        thread need not wake up after exactly <VAR>x</VAR> ticks.  Just put it on
                                                        the ready queue after they have waited for the right amount of time.
                                                        </p>
                                                        <P>
                                                            <CODE>timer_sleep()</CODE> is useful for threads that operate in real-time,
                                                            e.g. for blinking the cursor once per second.
                                                        </P>
                                                        <P>

                                                            The argument to <CODE>timer_sleep()</CODE> is expressed in timer ticks, not in
                                                            milliseconds or any another unit.  There are <CODE>TIMER_FREQ</CODE> timer
                                                            ticks per second, where <CODE>TIMER_FREQ</CODE> is a macro defined in
                                                            <CODE>devices/timer.h</CODE>.  The default value is 100.  We don't recommend
                                                            changing this value, because any change is likely to cause many of
                                                            the tests to fail.
                                                        </P>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
			                         
                                
                                <P>

                                    Separate functions <CODE>timer_msleep()</CODE>, <CODE>timer_usleep()</CODE>, and
                                    <CODE>timer_nsleep()</CODE> do exist for sleeping a specific number of
                                    milliseconds, microseconds, or nanoseconds, respectively, but these will
                                    call <CODE>timer_sleep()</CODE> automatically when necessary.  You do not need
                                    to modify them.
                                </P>
                                <P>

                                    If your delays seem too short or too long, reread the explanation of the
                                    <Q><SAMP>-r</SAMP></Q> option to <CODE>pintos</CODE> (see section <A HREF="pintos_1.html#SEC6">1.1.4 Debugging versus Testing</A>).
                                </P>
                                <P>

                                    The alarm clock implementation is not needed for later projects,
                                    although it could be useful for project 4.
                                </P>
                                </div><!--//section-block-->
                                 <div id="priority"  class="section-block">
                                    <h3 class="block-title">Priority Scheduling</h3>
                                    <P>

                                        Implement priority scheduling in Pintos.
                                        When a thread is added to the ready list that has a higher priority
                                        than the currently running thread, the current thread should
                                        immediately yield the processor to the new thread.  Similarly, when
                                        threads are waiting for a lock, semaphore, or condition variable, the
                                        highest priority waiting thread should be awakened first.  A thread
                                        may raise or lower its own priority at any time, but lowering its
                                        priority such that it no longer has the highest priority must cause it
                                        to immediately yield the CPU.
                                    </P>
                                    <P>

                                        Thread priorities range from <CODE>PRI_MIN</CODE> (0) to <CODE>PRI_MAX</CODE> (63).
                                        Lower numbers correspond to lower priorities, so that priority 0
                                        is the lowest priority and priority 63 is the highest.
                                        The initial thread priority is passed as an argument to
                                        <CODE>thread_create()</CODE>.  If there's no reason to choose another
                                        priority, use <CODE>PRI_DEFAULT</CODE> (31).  The <CODE>PRI_</CODE> macros are
                                        defined in <Q><TT>threads/thread.h</TT></Q>, and you should not change their
                                        values.
                                    </P>
                                    <P>

                                        One issue with priority scheduling is &quot;priority inversion&quot;.  Consider
                                        high, medium, and low priority threads <VAR>H</VAR>, <VAR>M</VAR>, and <VAR>L</VAR>,
                                        respectively.  If <VAR>H</VAR> needs to wait for <VAR>L</VAR> (for instance, for a
                                        lock held by <VAR>L</VAR>), and <VAR>M</VAR> is on the ready list, then <VAR>H</VAR>
                                        will never get the CPU because the low priority thread will not get any
                                        CPU time.  A partial fix for this problem is for <VAR>H</VAR> to &quot;donate&quot;
                                        its priority to <VAR>L</VAR> while <VAR>L</VAR> is holding the lock, then recall
                                        the donation once <VAR>L</VAR> releases (and thus <VAR>H</VAR> acquires) the lock.
                                    </P>
                                    <P>

                                        Implement priority donation.  You will need to account for all different
                                        situations in which priority donation is required.  Be sure to handle
                                        multiple donations, in which multiple priorities are donated to a single
                                        thread.  You must also handle nested donation: if <VAR>H</VAR> is waiting on
                                        a lock that <VAR>M</VAR> holds and <VAR>M</VAR> is waiting on a lock that <VAR>L</VAR>
                                        holds, then both <VAR>M</VAR> and <VAR>L</VAR> should be boosted to <VAR>H</VAR>'s
                                        priority.  If necessary, you may impose a reasonable limit on depth of
                                        nested priority donation, such as 8 levels.
                                    </P>
                                    <P>

                                        You must implement priority donation for locks.  You need not
                                        implement priority donation for the other Pintos synchronization
                                        constructs.  You do need to implement priority scheduling in all
                                        cases.
                                    </P>
                                    <P>

                                        Finally, implement the following functions that allow a thread to
                                        examine and modify its own priority.  Skeletons for these functions are
                                        provided in <Q><TT>threads/thread.c</TT></Q>.
                                    </P>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th><U>Function:</U> void <B>thread_set_priority</B> (int <VAR>new_priority</VAR>)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td scope="row">
                                                        Sets the current thread's priority to <VAR>new_priority</VAR>.  If the
                                                        current thread no longer has the highest priority, yields.
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th><U>Function:</U> int <B>thread_get_priority</B> (void)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td scope="row">
                                                     Returns the current thread's priority.  In the presence of priority
                                                     donation, returns the higher (donated) priority.
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <P>

                                        You need not provide any interface to allow a thread to directly modify
                                        other threads' priorities.
                                    </P>
                                    <P>

                                        The priority scheduler is not used in any later project.
                                    </P>
                                </div> <!--//section-block-->
                                 <div id="advanced"  class="section-block">
                                    <h3 class="block-title">Advanced Scheduler (May be optional)</h3>
                                    <P>

                                        Implement a multilevel feedback queue scheduler similar to the
                                        4.4<ACRONYM>BSD</ACRONYM> scheduler to
                                        reduce the average response time for running jobs on your system.
                                        See section <A HREF="pintos_7.html#SEC131">B. 4.4<ACRONYM>BSD</ACRONYM> Scheduler</A>, for detailed requirements.
                                    </P>
                                    <P>

                                        Like the priority scheduler, the advanced scheduler chooses the thread
                                        to run based on priorities.  However, the advanced scheduler does not do
                                        priority donation.  Thus, we recommend that you have the priority
                                        scheduler working, except possibly for priority donation, before you
                                        start work on the advanced scheduler.
                                    </P>
                                    <P>

                                        You must write your code to allow us to choose a scheduling algorithm
                                        policy at Pintos startup time.  By default, the priority scheduler
                                        must be active, but we must be able to choose the 4.4<ACRONYM>BSD</ACRONYM>
                                        scheduler
                                        with the <Q><SAMP>-mlfqs</SAMP></Q> kernel option.  Passing this
                                        option sets <CODE>thread_mlfqs</CODE>, declared in <Q><TT>threads/thread.h</TT></Q>, to
                                        true when the options are parsed by <CODE>parse_options()</CODE>, which happens
                                        early in <CODE>main()</CODE>.
                                    </P>
                                    <P>

                                        When the 4.4<ACRONYM>BSD</ACRONYM> scheduler is enabled, threads no longer
                                        directly control their own priorities.  The <VAR>priority</VAR> argument to
                                        <CODE>thread_create()</CODE> should be ignored, as well as any calls to
                                        <CODE>thread_set_priority()</CODE>, and <CODE>thread_get_priority()</CODE> should return
                                        the thread's current priority as set by the scheduler.
                                    </P>
                                    <P>

                                        The advanced scheduler is not used in any later project.
                                    </P>
                                </div> 

                            </section><!--//doc-section-->
                            
                            <section id="faq-section" class="doc-section">
                                <h2 class="section-title">FAQ</h2>
                                <div class="section-block">
                                    <DL COMPACT>
                                        <DT><h5>How much code will I need to write?</h5>
                                            <DD><P>

                                                Here's a summary of our reference solution, produced by the
                                                <CODE>diffstat</CODE> program.  The final row gives total lines inserted
                                                and deleted; a changed line counts as both an insertion and a deletion.
                                            </P>
                                            <P>

                                                The reference solution represents just one possible solution.  Many
                                                other solutions are also possible and many of those differ greatly from
                                                the reference solution.  Some excellent solutions may not modify all the
                                                files modified by the reference solution, and some may modify files not
                                                modified by the reference solution.
                                            </P>
                                            <P>

                                                <TABLE><tr><td>&nbsp;</td><td class=example><pre> 
devices/timer.c       |   42 +++++-
threads/fixed-point.h |  120 ++++++++++++++++++
threads/synch.c       |   88 ++++++++++++-
threads/thread.c      |  196 ++++++++++++++++++++++++++----
threads/thread.h      |   23 +++
5 files changed, 440 insertions(+), 29 deletions(-)
                                               </pre></td></tr></table><P>

                                                <Q><TT>fixed-point.h</TT></Q> is a new file added by the reference solution.
                                            </P>
                                            <P>

                                            </P>
                                            <DT><h5>How do I update the <Q><TT>Makefile</TT></Q>s when I add a new source file?</h5>
                                                <DD><P>

                                                    <A NAME="Adding Source Files"></A>
                                                    To add a <Q><TT>.c</TT></Q> file, edit the top-level <Q><TT>Makefile.build</TT></Q>.
                                                    Add the new file to variable <Q><SAMP><VAR>dir</VAR>_SRC</SAMP></Q>, where
                                                    <VAR>dir</VAR> is the directory where you added the file.  For this
                                                    project, that means you should add it to <CODE>threads_SRC</CODE> or
                                                    <CODE>devices_SRC</CODE>.  Then run <CODE>make</CODE>.  If your new file
                                                    doesn't get
                                                    compiled, run <CODE>make clean</CODE> and then try again.
                                                </P>
                                                <P>

                                                    When you modify the top-level <Q><TT>Makefile.build</TT></Q> and re-run
                                                    <CODE>make</CODE>, the modified
                                                    version should be automatically copied to
                                                    <Q><TT>threads/build/Makefile</TT></Q>.  The converse is
                                                    not true, so any changes will be lost the next time you run <CODE>make
                                                    clean</CODE> from the <Q><TT>threads</TT></Q> directory.  Unless your changes are
                                                    truly temporary, you should prefer to edit <Q><TT>Makefile.build</TT></Q>.
                                                </P>
                                                <P>

                                                    A new <Q><TT>.h</TT></Q> file does not require editing the <Q><TT>Makefile</TT></Q>s.
                                                </P>
                                                <P>

                                                </P>
                                                <DT><h5>What does "warning: no previous prototype for `<VAR>func</VAR>'" mean?</h5>
                                                    <DD><P>

                                                        It means that you defined a non-<CODE>static</CODE> function without
                                                        preceding it by a prototype.  Because non-<CODE>static</CODE> functions are
                                                        intended for use by other <Q><TT>.c</TT></Q> files, for safety they should be
                                                        prototyped in a header file included before their definition.  To fix
                                                        the problem, add a prototype in a header file that you include, or, if
                                                        the function isn't actually used by other <Q><TT>.c</TT></Q> files, make it
                                                        <CODE>static</CODE>.
                                                    </P>
                                                    <P>

                                                    </P>
                                                    <DT><h5>What is the interval between timer interrupts?</h5>
                                                        <DD><P>

                                                            Timer interrupts occur <CODE>TIMER_FREQ</CODE> times per second.  You can
                                                            adjust this value by editing <Q><TT>devices/timer.h</TT></Q>.  The default is
                                                            100 Hz.
                                                        </P>
                                                        <P>

                                                            We don't recommend changing this value, because any changes are likely
                                                            to cause many of the tests to fail.
                                                        </P>
                                                        <P>

                                                        </P>
                                                        <DT><h5>How long is a time slice?</h5>
                                                            <DD><P>

                                                                There are <CODE>TIME_SLICE</CODE> ticks per time slice.  This macro is
                                                                declared in <Q><TT>threads/thread.c</TT></Q>.  The default is 4 ticks.
                                                            </P>
                                                            <P>

                                                                We don't recommend changing this value, because any changes are likely
                                                                to cause many of the tests to fail.
                                                            </P>
                                                            <P>

                                                            </P>
                                                            <DT><h5>How do I run the tests?</h5>
                                                                <DD><P>

                                                                    See section <A HREF="pintos_1.html#SEC8">1.2.1 Testing</A>.
                                                                </P>
                                                                <P>

                                                                </P>
                                                                <DT><h5>Why do I get a test failure in <CODE>pass()</CODE>?</h5>
                                                                    <DD><P>

                                                                        <A NAME="The pass function fails"></A>
                                                                        You are probably looking at a backtrace that looks something like this:
                                                                    </P>
                                                                    <P>

                                                                        <TABLE><tr><td>&nbsp;</td><td class=example><pre>
0xc0108810: debug_panic (lib/kernel/debug.c:32)
0xc010a99f: pass (tests/threads/tests.c:93)
0xc010bdd3: test_mlfqs_load_1 (...threads/mlfqs-load-1.c:33)
0xc010a8cf: run_test (tests/threads/tests.c:51)
0xc0100452: run_task (threads/init.c:283)
0xc0100536: run_actions (threads/init.c:333)
0xc01000bb: main (threads/init.c:137)
                                                                        </pre></td></tr></table><P>

                                                                            This is just confusing output from the <CODE>backtrace</CODE> program.  It
                                                                            does not actually mean that <CODE>pass()</CODE> called <CODE>debug_panic()</CODE>.  In
                                                                            fact, <CODE>fail()</CODE> called <CODE>debug_panic()</CODE> (via the <CODE>PANIC()</CODE>
                                                                            macro).  GCC knows that <CODE>debug_panic()</CODE> does not return, because it
                                                                            is declared <CODE>NO_RETURN</CODE> (see section <A HREF="pintos_10.html#SEC148">E.3 Function and Parameter Attributes</A>), so it doesn't include any code in <CODE>fail()</CODE> to take
                                                                            control when <CODE>debug_panic()</CODE> returns.  This means that the return
                                                                            address on the stack looks like it is at the beginning of the function
                                                                            that happens to follow <CODE>fail()</CODE> in memory, which in this case happens
                                                                            to be <CODE>pass()</CODE>.
                                                                        </P>
                                                                        <P>

                                                                            See section <A HREF="pintos_10.html#SEC149">E.4 Backtraces</A>, for more information.
                                                                        </P>
                                                                        <P>

                                                                        </P>
                                                                        <DT><h5>How do interrupts get re-enabled in the new thread following <CODE>schedule()</CODE>?</h5>
                                                                            <DD><P>

                                                                                Every path into <CODE>schedule()</CODE> disables interrupts.  They eventually
                                                                                get re-enabled by the next thread to be scheduled.  Consider the
                                                                                possibilities: the new thread is running in <CODE>switch_thread()</CODE> (but
                                                                                see below), which is called by <CODE>schedule()</CODE>, which is called by one
                                                                                of a few possible functions:
                                                                            </P>
                                                                            <P>

                                                                                <UL>
                                                                                    <LI>
                                                                                        <CODE>thread_exit()</CODE>, but we'll never switch back into such a thread, so
                                                                                        it's uninteresting.
                                                                                        <P>

                                                                                        </P>
                                                                                        <LI>
                                                                                            <CODE>thread_yield()</CODE>, which immediately restores the interrupt level upon
                                                                                            return from <CODE>schedule()</CODE>.
                                                                                            <P>

                                                                                            </P>
                                                                                            <LI>
                                                                                                <CODE>thread_block()</CODE>, which is called from multiple places:
                                                                                                <P>

                                                                                                    <UL>
                                                                                                        <LI>
                                                                                                            <CODE>sema_down()</CODE>, which restores the interrupt level before returning.
                                                                                                            <P>

                                                                                                            </P>
                                                                                                            <LI>
                                                                                                                <CODE>idle()</CODE>, which enables interrupts with an explicit assembly STI
                                                                                                                instruction.
                                                                                                                <P>

                                                                                                                </P>
                                                                                                                <LI>
                                                                                                                    <CODE>wait()</CODE> in <Q><TT>devices/intq.c</TT></Q>, whose callers are responsible for
                                                                                                                    re-enabling interrupts.
                                                                                                                </UL>
                                                                                                            </UL>
                                                                                                            <P>

                                                                                                                There is a special case when a newly created thread runs for the first
                                                                                                                time.  Such a thread calls <CODE>intr_enable()</CODE> as the first action in
                                                                                                                <CODE>kernel_thread()</CODE>, which is at the bottom of the call stack for every
                                                                                                                kernel thread but the first.
                                                                                                            </DL>
                            </section><!--//legal-section-->
                           
                        </div><!--//content-inner-->
                    </div><!--//doc-content-->
                    <div class="doc-sidebar hidden-xs">
                        <nav id="doc-nav">
                            <ul id="doc-menu" class="nav doc-menu" data-spy="affix">
                                <li><a class="scrollto" href="#background-section">Background</a>
                                    <ul class="nav doc-sub-menu">
                                        <li><a class="scrollto" href="#understanding">Understanding Threads</a></li>
                                        <li><a class="scrollto" href="#source">Source Files</a></li>
                                        <li><a class="scrollto" href="#sync">Synchronization</a></li>
                                        <li><a class="scrollto" href="#devsuggestion">Develpment Suggestions</a></li>
                                    </ul><!--//nav-->
                                </li>
                                <li>
                                    <a class="scrollto" href="#requirement-section">Requirements</a>
                                    <ul class="nav doc-sub-menu">
                                        <li><a class="scrollto" href="#document">Design Document</a></li>
                                        <li><a class="scrollto" href="#alarm">Alarm Clock</a></li>
                                        <li><a class="scrollto" href="#priority">Priority Scheduling</a></li>
                                        <li><a class="scrollto" href="#advanced">Advanced Scheduler</a></li>
                                    </ul><!--//nav-->
                                </li>
                                <li><a class="scrollto" href="#faq-section">FAQ</a>
                                    <ul class="nav doc-sub-menu">
                                        <li><a class="scrollto" href="#alarmfaq">Alarm Clock FAQ</a></li>
                                        <li><a class="scrollto" href="#priorityfaq">Priority Scheduling FAQ</a></li>
                                        <li><a class="scrollto" href="#advancedfaq">Advanced Scheduler FAQ</a></li>
                                    </ul><!--//nav-->
                                </li>
                            </ul><!--//doc-menu-->
                        </nav>
                    </div><!--//doc-sidebar-->
                </div><!--//doc-body-->              
            </div><!--//container-->
        </div><!--//doc-wrapper-->
        
     
        
    </div><!--//page-wrapper-->
    
    <footer id="footer" class="footer text-center">
        <div class="container">
            <small class="copyright"> 이 문서의 저작권은 이 프로젝트의 Github repository에 있는 license.md 파일에 따릅니다.</small>
                <br>
                <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can check out other license options via our website: themes.3rdwavemedia.com */-->
                <small class="copyright">The template is designed with <i class="fa fa-heart"></i> by <a href="http://themes.3rdwavemedia.com/" targe="_blank">Xiaoying Riley</a> for developers</small>
            
        </div><!--//container-->
    </footer><!--//footer-->
    
     
    <!-- Main Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>                                                                
    <script type="text/javascript" src="assets/plugins/jquery-match-height/jquery.matchHeight-min.js"></script>
    <script type="text/javascript" src="assets/js/main.js"></script>
    
</body>
</html> 

